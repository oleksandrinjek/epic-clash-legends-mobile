#!/usr/bin/env node

const fs = require('fs');
const path = require('path');
const readline = require('readline');

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

console.log('ðŸŽ® Epic Clash Legends Mobile - Supabase Setup');
console.log('==============================================\n');

const envPath = path.join(process.cwd(), '.env');

// Check if .env already exists
if (fs.existsSync(envPath)) {
  console.log('âš ï¸  .env file already exists!');
  rl.question('Do you want to overwrite it? (y/N): ', (answer) => {
    if (answer.toLowerCase() === 'y' || answer.toLowerCase() === 'yes') {
      runSetup();
    } else {
      console.log('Setup cancelled.');
      rl.close();
    }
  });
} else {
  runSetup();
}

function runSetup() {
  console.log('\nðŸ“‹ Let\'s set up your Supabase configuration!\n');
  
  console.log('1. Go to https://supabase.com and create a new project');
  console.log('2. Once your project is created, go to Settings > API');
  console.log('3. Copy your Project URL and anon/public key\n');
  
  rl.question('Enter your Supabase Project URL: ', (supabaseUrl) => {
    if (!supabaseUrl.trim()) {
      console.log('âŒ Project URL is required!');
      rl.close();
      return;
    }
    
    rl.question('Enter your Supabase anon/public key: ', (supabaseKey) => {
      if (!supabaseKey.trim()) {
        console.log('âŒ Anon key is required!');
        rl.close();
        return;
      }
      
      // Create .env file
      const envContent = `# Supabase Configuration
# Generated by setup-supabase.js
VITE_SUPABASE_URL=${supabaseUrl.trim()}
VITE_SUPABASE_ANON_KEY=${supabaseKey.trim()}
`;
      
      try {
        fs.writeFileSync(envPath, envContent);
        console.log('\nâœ… .env file created successfully!');
        
        console.log('\nðŸ“š Next steps:');
        console.log('1. Run the SQL schema in your Supabase SQL Editor:');
        console.log('   - Copy the contents of supabase-schema.sql');
        console.log('   - Paste it in your Supabase project\'s SQL Editor');
        console.log('   - Click "Run" to create the database tables');
        console.log('\n2. Start the development server:');
        console.log('   npm run dev');
        console.log('\n3. Your game will now save progress to Supabase! ðŸŽ‰');
        
      } catch (error) {
        console.error('âŒ Error creating .env file:', error.message);
      }
      
      rl.close();
    });
  });
}

rl.on('close', () => {
  process.exit(0);
});
